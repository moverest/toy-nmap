#include "scan.h"

#include <stdio.h>
#include <string.h>
#include <stdbool.h>
#include <time.h>

#include "tcputils.h"
#include "udputils.h"

#define TCP    0
#define UDP    1

typedef struct {
    uint16_t port;
    char     *name;
} usual;

usual tcp_names[] = {
    (usual) {.port = 1,     .name = "TCPMUX - TCP Port Service Multiplexer"                                                                                         },
    (usual) {.port = 2,     .name = "compressnet - Management Utility"                                                                                              },
    (usual) {.port = 3,     .name = "compressnet - Compression Process"                                                                                             },
    (usual) {.port = 5,     .name = "rje - Remote job entry "                                                                                                       },
    (usual) {.port = 7,     .name = "echo"                                                                                                                          },
    (usual) {.port = 9,     .name = "Discard Protocol "                                                                                                             },
    (usual) {.port = 11,    .name = "SYSTAT - Active Users"                                                                                                         },
    (usual) {.port = 13,    .name = "Daytime Protocol  RFC 867"                                                                                                     },
    (usual) {.port = 17,    .name = "qotd - Quote of the Day"                                                                                                       },
    (usual) {.port = 18,    .name = "msp - Message send protocol "                                                                                                  },
    (usual) {.port = 19,    .name = "CHARGEN - Character Generator Protocol "                                                                                       },
    (usual) {.port = 20,    .name = "ftp-data - File Transfer Protocol [flux de données]"                                                                           },
    (usual) {.port = 21,    .name = "ftp - File Transfer Protocol (le flux de contrôle pour le transfert de fichiers), voir Diagramme des flux FTP (port 20 et 21)" },
    (usual) {.port = 22,    .name = "SSH - Secure Shell - SFTP"                                                                                                     },
    (usual) {.port = 23,    .name = "telnet"                                                                                                                        },
    (usual) {.port = 24,    .name = "any private mail system"                                                                                                       },
    (usual) {.port = 25,    .name = "smtp - Simple Mail Transfer Protocol RFC 5321"                                                                                 },
    (usual) {.port = 27,    .name = "nsw-fe - NSW User System FE"                                                                                                   },
    (usual) {.port = 29,    .name = "msg-icp"                                                                                                                       },
    (usual) {.port = 31,    .name = "msg-auth - MSG Authentication"                                                                                                 },
    (usual) {.port = 33,    .name = "dsp - Display Support Protocol"                                                                                                },
    (usual) {.port = 35,    .name = "any private printer server"                                                                                                    },
    (usual) {.port = 37,    .name = "Time Protocol RFC 868"                                                                                                         },
    (usual) {.port = 38,    .name = "rap - Route Access Protocol"                                                                                                   },
    (usual) {.port = 39,    .name = "rlp - Resource Location Protocol"                                                                                              },
    (usual) {.port = 41,    .name = "graphics"                                                                                                                      },
    (usual) {.port = 42,    .name = "nameserver - Host Name Server"                                                                                                 },
    (usual) {.port = 43,    .name = "nicname - Who Is"                                                                                                              },
    (usual) {.port = 44,    .name = "mpm-flags - MPM FLAGS Protocol"                                                                                                },
    (usual) {.port = 45,    .name = "mpm - Message Processing Module [recv]"                                                                                        },
    (usual) {.port = 46,    .name = "mpm - Message Processing Module [default send]"                                                                                },
    (usual) {.port = 47,    .name = "ni-ftp"                                                                                                                        },
    (usual) {.port = 48,    .name = "auditd - Digital Audit Daemon"                                                                                                 },
    (usual) {.port = 49,    .name = "login - Login Host Protocol (Terminal Access Controller Access-Control System)"                                                },
    (usual) {.port = 51,    .name = "la-maint - IMP Logical Address Maintenance"                                                                                    },
    (usual) {.port = 52,    .name = "xns-time - XNS Time Protocol"                                                                                                  },
    (usual) {.port = 55,    .name = "isi-gl - ISI Graphics Language"                                                                                                },
    (usual) {.port = 56,    .name = "xns-auth - XNS Authentication"                                                                                                 },
    (usual) {.port = 57,    .name = "any private terminal access"                                                                                                   },
    (usual) {.port = 58,    .name = "xns-mail - XNS Mail"                                                                                                           },
    (usual) {.port = 59,    .name = "any private file service"                                                                                                      },
    (usual) {.port = 61,    .name = "ni-mail"                                                                                                                       },
    (usual) {.port = 62,    .name = "acas - ACA Services"                                                                                                           },
    (usual) {.port = 64,    .name = "covia - Communications Integrator (CI)"                                                                                        },
    (usual) {.port = 65,    .name = "tacacs-ds - TACACS-Database Service"                                                                                           },
    (usual) {.port = 70,    .name = "gopher"                                                                                                                        },
    (usual) {.port = 71,    .name = "netrjs-1 Remote Job Service"                                                                                                   },
    (usual) {.port = 72,    .name = "netrjs-2 Remote Job Service"                                                                                                   },
    (usual) {.port = 73,    .name = "netrjs-3 Remote Job Service"                                                                                                   },
    (usual) {.port = 74,    .name = "netrjs-4 Remote Job Service"                                                                                                   },
    (usual) {.port = 75,    .name = "any private dial out service"                                                                                                  },
    (usual) {.port = 76,    .name = "deos - Distributed External Object Store"                                                                                      },
    (usual) {.port = 77,    .name = "any private RJE service"                                                                                                       },
    (usual) {.port = 78,    .name = "vetTCP"                                                                                                                        },
    (usual) {.port = 79,    .name = "finger"                                                                                                                        },
    (usual) {.port = 80,    .name = "www-http - World Wide Web HTTP"                                                                                                },
    (usual) {.port = 81,    .name = "host2-ns - HOSTS2 Name Server"                                                                                                 },
    (usual) {.port = 82,    .name = "xfer - XFER Utility"                                                                                                           },
    (usual) {.port = 83,    .name = "mit-ml-dev"                                                                                                                    },
    (usual) {.port = 84,    .name = "ctf - Common Trace Facility"                                                                                                   },
    (usual) {.port = 85,    .name = "mit-ml-dev"                                                                                                                    },
    (usual) {.port = 86,    .name = "mfcobol - Micro Focus Cobol"                                                                                                   },
    (usual) {.port = 87,    .name = "any private terminal link"                                                                                                     },
    (usual) {.port = 88,    .name = "kerberos"                                                                                                                      },
    (usual) {.port = 89,    .name = "su-mit-tg - SU/MIT Telnet Gateway"                                                                                             },
    (usual) {.port = 90,    .name = "dnsix - DNSIX Security Attribute Token Map"                                                                                    },
    (usual) {.port = 91,    .name = "mit-dov - MIT Dover Spooler"                                                                                                   },
    (usual) {.port = 92,    .name = "npp - Network Printing Protocol"                                                                                               },
    (usual) {.port = 93,    .name = "dcp - Device Control Protocol"                                                                                                 },
    (usual) {.port = 94,    .name = "objcall - Tivoli Object Dispatcher"                                                                                            },
    (usual) {.port = 95,    .name = "supdup"                                                                                                                        },
    (usual) {.port = 96,    .name = "dixie - DIXIE Protocol Specification"                                                                                          },
    (usual) {.port = 97,    .name = "swift-rvf - Swift Remote Virtual File Protocol"                                                                                },
    (usual) {.port = 98,    .name = "tacnews"                                                                                                                       },
    (usual) {.port = 99,    .name = "metagram - Metagram Relay"                                                                                                     },
    (usual) {.port = 100,   .name = "newacct - [unauthorized use]"                                                                                                  },
    (usual) {.port = 101,   .name = "hostname - NIC Host Name Server"                                                                                               },
    (usual) {.port = 102,   .name = "iso-tsap"                                                                                                                      },
    (usual) {.port = 103,   .name = "gppitnp - Genesis Point-To-Point Trans Net"                                                                                    },
    (usual) {.port = 104,   .name = "acr-nema - ACR-NEMA Digital Imag. & Comm. 300"                                                                                 },
    (usual) {.port = 105,   .name = "csnet-ns - Mailbox Name Nameserver"                                                                                            },
    (usual) {.port = 106,   .name = "3com-tsmux"                                                                                                                    },
    (usual) {.port = 107,   .name = "rtelnet - Remote Telnet Service"                                                                                               },
    (usual) {.port = 108,   .name = "snagas - SNA Gateway Access Server"                                                                                            },
    (usual) {.port = 109,   .name = "pop2 - Post Office Protocol - Version 2 RFC 937"                                                                               },
    (usual) {.port = 110,   .name = "pop3 - Post Office Protocol - Version 3 RFC 1939"                                                                              },
    (usual) {.port = 111,   .name = "sunrpc - SUN Remote Procedure Call"                                                                                            },
    (usual) {.port = 112,   .name = "mcidas - McIDAS Data Transmission Protocol"                                                                                    },
    (usual) {.port = 113,   .name = "auth - Authentication Service"                                                                                                 },
    (usual) {.port = 114,   .name = "audionews - Audio News Multicast"                                                                                              },
    (usual) {.port = 115,   .name = "sftp - Simple File Transfer Protocol  (Ubuntu)"                                                                                },
    (usual) {.port = 116,   .name = "ansanotify - ANSA REX Notify"                                                                                                  },
    (usual) {.port = 117,   .name = "uucp-path - UUCP Path Service"                                                                                                 },
    (usual) {.port = 118,   .name = "sqlserv - SQL Services"                                                                                                        },
    (usual) {.port = 119,   .name = "nntp - Network News Transfer Protocol RFC 3977"                                                                                },
    (usual) {.port = 120,   .name = "cfdptkt"                                                                                                                       },
    (usual) {.port = 121,   .name = "erpc - Encore Expedited Remote Pro.Call"                                                                                       },
    (usual) {.port = 122,   .name = "smakynet"                                                                                                                      },
    (usual) {.port = 124,   .name = "ansatrader - ANSA REX Trader"                                                                                                  },
    (usual) {.port = 125,   .name = "locus-map - Locus PC-Interface Net Map Server"                                                                                 },
    (usual) {.port = 126,   .name = "unitary - Unisys Unitary Login"                                                                                                },
    (usual) {.port = 127,   .name = "locus-con - Locus PC-Interface Conn Server"                                                                                    },
    (usual) {.port = 128,   .name = "gss-xlicen - GSS X License Verification"                                                                                       },
    (usual) {.port = 129,   .name = "pwdgen - Password Generator Protocol"                                                                                          },
    (usual) {.port = 130,   .name = "cisco-fna - cisco FNATIVE"                                                                                                     },
    (usual) {.port = 131,   .name = "cisco-tna - cisco TNATIVE"                                                                                                     },
    (usual) {.port = 132,   .name = "cisco-sys - cisco SYSMAINT"                                                                                                    },
    (usual) {.port = 133,   .name = "statsrv - Statistics Service"                                                                                                  },
    (usual) {.port = 135,   .name = "loc-srv - Location Service"                                                                                                    },
    (usual) {.port = 136,   .name = "profile - PROFILE Naming System"                                                                                               },
    (usual) {.port = 137,   .name = "netbios-ns - NETBIOS Name Service"                                                                                             },
    (usual) {.port = 138,   .name = "netbios-dgm - NETBIOS Datagram Service"                                                                                        },
    (usual) {.port = 139,   .name = "netbios-ssn - NETBIOS Session Service"                                                                                         },
    (usual) {.port = 140,   .name = "emfis-data - EMFIS Data Service"                                                                                               },
    (usual) {.port = 141,   .name = "emfis-cntl - EMFIS Control Service"                                                                                            },
    (usual) {.port = 142,   .name = "bl-idm - Britton-Lee IDM"                                                                                                      },
    (usual) {.port = 143,   .name = "imap2, imap4 - Internet Message Access Protocol v4 RFC 3501"                                                                   },
    (usual) {.port = 144,   .name = "news"                                                                                                                          },
    (usual) {.port = 145,   .name = "uaac"                                                                                                                          },
    (usual) {.port = 146,   .name = "iso-tp0"                                                                                                                       },
    (usual) {.port = 147,   .name = "iso-ip"                                                                                                                        },
    (usual) {.port = 148,   .name = "cronus - CRONUS-SUPPORT"                                                                                                       },
    (usual) {.port = 149,   .name = "aed-512 - AED 512 Emulation Service"                                                                                           },
    (usual) {.port = 150,   .name = "sql-net"                                                                                                                       },
    (usual) {.port = 151,   .name = "hems"                                                                                                                          },
    (usual) {.port = 152,   .name = "bftp - Background File Transfer Program"                                                                                       },
    (usual) {.port = 153,   .name = "sgmp"                                                                                                                          },
    (usual) {.port = 154,   .name = "netsc-prod"                                                                                                                    },
    (usual) {.port = 155,   .name = "netsc-dev"                                                                                                                     },
    (usual) {.port = 156,   .name = "sqlsrv - SQL Service"                                                                                                          },
    (usual) {.port = 157,   .name = "knet-cmp - KNET/VM Command/Message Protocol"                                                                                   },
    (usual) {.port = 158,   .name = "pcmail-srv - PCMail Server"                                                                                                    },
    (usual) {.port = 159,   .name = "nss-routing"                                                                                                                   },
    (usual) {.port = 160,   .name = "sgmp-traps"                                                                                                                    },
    (usual) {.port = 163,   .name = "cmip-man - CMIP/TCP Manager"                                                                                                   },
    (usual) {.port = 164,   .name = "cmip-agent - CMIP/TCP Agent"                                                                                                   },
    (usual) {.port = 165,   .name = "xns-courier - Xerox"                                                                                                           },
    (usual) {.port = 166,   .name = "s-net - Sirius Systems"                                                                                                        },
    (usual) {.port = 167,   .name = "namp"                                                                                                                          },
    (usual) {.port = 168,   .name = "rsvd"                                                                                                                          },
    (usual) {.port = 169,   .name = "send"                                                                                                                          },
    (usual) {.port = 170,   .name = "print-srv - Network PostScript"                                                                                                },
    (usual) {.port = 171,   .name = "multiplex - Network Innovations Multiplex"                                                                                     },
    (usual) {.port = 172,   .name = "cl/1 - Network Innocations CL/1"                                                                                               },
    (usual) {.port = 173,   .name = "xyplex-mux - Xyplex"                                                                                                           },
    (usual) {.port = 174,   .name = "mailq"                                                                                                                         },
    (usual) {.port = 175,   .name = "vmnet"                                                                                                                         },
    (usual) {.port = 176,   .name = "genrad-mux"                                                                                                                    },
    (usual) {.port = 177,   .name = "xdmcp - X Display Manager Control Protocol"                                                                                    },
    (usual) {.port = 178,   .name = "nextstep - NeXTSTEP Window Server"                                                                                             },
    (usual) {.port = 179,   .name = "bgp - Border Gateway Protocol"                                                                                                 },
    (usual) {.port = 180,   .name = "ris - Intergraph"                                                                                                              },
    (usual) {.port = 181,   .name = "unify"                                                                                                                         },
    (usual) {.port = 182,   .name = "audit - Unisys Audit SITP"                                                                                                     },
    (usual) {.port = 183,   .name = "ocbinder"                                                                                                                      },
    (usual) {.port = 184,   .name = "ocserver"                                                                                                                      },
    (usual) {.port = 185,   .name = "remote-kis"                                                                                                                    },
    (usual) {.port = 186,   .name = "kis - KIS Protocol"                                                                                                            },
    (usual) {.port = 187,   .name = "aci - Application Communication Interface"                                                                                     },
    (usual) {.port = 188,   .name = "mumps - Plus Five's MUMPS"                                                                                                     },
    (usual) {.port = 189,   .name = "qft - Queued File Transport"                                                                                                   },
    (usual) {.port = 190,   .name = "gacp - Gateway Access Protocol"                                                                                                },
    (usual) {.port = 191,   .name = "prospero - Prospero Directory Service"                                                                                         },
    (usual) {.port = 192,   .name = "osu-nms - OSU Network Monitoring System"                                                                                       },
    (usual) {.port = 193,   .name = "srmp - Spider Remote Monitoring Protocol"                                                                                      },
    (usual) {.port = 194,   .name = "Internet relay chat (IRC)"                                                                                                     },
    (usual) {.port = 195,   .name = "dn6-nlm-aud - DNSIX Network Level Module Audit"                                                                                },
    (usual) {.port = 196,   .name = "dn6-nlm-red - DNSIX Session Mgt Module Audit Redir"                                                                            },
    (usual) {.port = 197,   .name = "dls - Directory Location Service"                                                                                              },
    (usual) {.port = 198,   .name = "dls-mon - Directory Location Service Monitor"                                                                                  },
    (usual) {.port = 199,   .name = "smux"                                                                                                                          },
    (usual) {.port = 200,   .name = "src - IBM System Resource Controller"                                                                                          },
    (usual) {.port = 201,   .name = "at-rtmp - AppleTalk Routing Maintenance"                                                                                       },
    (usual) {.port = 202,   .name = "at-nbp - AppleTalk Name Binding"                                                                                               },
    (usual) {.port = 203,   .name = "at-3 - AppleTalk Unused"                                                                                                       },
    (usual) {.port = 204,   .name = "at-echo - AppleTalk Echo"                                                                                                      },
    (usual) {.port = 205,   .name = "at-5 - AppleTalk Unused"                                                                                                       },
    (usual) {.port = 206,   .name = "at-zis - AppleTalk Zone Information"                                                                                           },
    (usual) {.port = 207,   .name = "at-7 - AppleTalk Unused"                                                                                                       },
    (usual) {.port = 208,   .name = "at-8 - AppleTalk Unused"                                                                                                       },
    (usual) {.port = 209,   .name = "tam - Trivial Mail Authentication Protocol"                                                                                    },
    (usual) {.port = 210,   .name = "z39.50"                                                                                                                        },
    (usual) {.port = 211,   .name = "914c/g - Texas Instruments 914C/G Terminal"                                                                                    },
    (usual) {.port = 212,   .name = "anet - ATEXSSTR"                                                                                                               },
    (usual) {.port = 213,   .name = "ipx"                                                                                                                           },
    (usual) {.port = 214,   .name = "vmpwscs - VM PWSCS"                                                                                                            },
    (usual) {.port = 215,   .name = "softpc - Insignia Solutions"                                                                                                   },
    (usual) {.port = 216,   .name = "atls - Access Technology License Server"                                                                                       },
    (usual) {.port = 217,   .name = "dbase - dBASE Unix"                                                                                                            },
    (usual) {.port = 218,   .name = "mpp - Netix Message Posting Protocol"                                                                                          },
    (usual) {.port = 219,   .name = "uarps - Unisys ARPs"                                                                                                           },
    (usual) {.port = 220,   .name = "imap3 - Interactive Mail Access Protocol v3 RFC 1203"                                                                          },
    (usual) {.port = 221,   .name = "fln-spx - Berkeley rlogind with SPX auth"                                                                                      },
    (usual) {.port = 222,   .name = "rsh-spx - Berkeley rshd with SPX auth"                                                                                         },
    (usual) {.port = 223,   .name = "cdc - Certificate Distribution Center"                                                                                         },
    (usual) {.port = 243,   .name = "sur-meas - Surveet Measurement"                                                                                                },
    (usual) {.port = 245,   .name = "link"                                                                                                                          },
    (usual) {.port = 246,   .name = "dsp3270 - Display Systems Protocol"                                                                                            },
    (usual) {.port = 344,   .name = "pdap - Prospero Data Access Protocol"                                                                                          },
    (usual) {.port = 345,   .name = "pawserv - Perf Analysis Workbench"                                                                                             },
    (usual) {.port = 346,   .name = "zserv - Zebra server"                                                                                                          },
    (usual) {.port = 347,   .name = "fatserv - Fatmen Server"                                                                                                       },
    (usual) {.port = 348,   .name = "csi-sgwp - Cabletron Management Protocol"                                                                                      },
    (usual) {.port = 371,   .name = "clearcase"                                                                                                                     },
    (usual) {.port = 372,   .name = "ulistserv - Unix Listserv"                                                                                                     },
    (usual) {.port = 373,   .name = "legent-1 - Legent Corporation"                                                                                                 },
    (usual) {.port = 374,   .name = "legent-2 - Legent Corporation"                                                                                                 },
    (usual) {.port = 375,   .name = "hassle"                                                                                                                        },
    (usual) {.port = 376,   .name = "nip - Amiga Envoy Network Inquiry Proto"                                                                                       },
    (usual) {.port = 377,   .name = "tnETOS - NEC Corporation"                                                                                                      },
    (usual) {.port = 378,   .name = "dsETOS - NEC Corporation"                                                                                                      },
    (usual) {.port = 379,   .name = "is99c - TIA/EIA/IS-99 modem client"                                                                                            },
    (usual) {.port = 380,   .name = "is99s - TIA/EIA/IS-99 modem server"                                                                                            },
    (usual) {.port = 381,   .name = "hp-collector - hp performance data collector"                                                                                  },
    (usual) {.port = 382,   .name = "hp-managed-node - hp performance data managed node"                                                                            },
    (usual) {.port = 383,   .name = "hp-alarm-mgr - hp performance data alarm manager"                                                                              },
    (usual) {.port = 384,   .name = "arns - A Remote Network Server System"                                                                                         },
    (usual) {.port = 385,   .name = "ibm-app - IBM Application"                                                                                                     },
    (usual) {.port = 386,   .name = "asa - ASA Message Router Object Def."                                                                                          },
    (usual) {.port = 387,   .name = "aurp - AppleTalk Update-Based Routing Pro."                                                                                    },
    (usual) {.port = 388,   .name = "unidata-ldm - Unidata LDM Version 4"                                                                                           },
    (usual) {.port = 389,   .name = "Lightweight Directory Access Protocol (LDAP)"                                                                                  },
    (usual) {.port = 390,   .name = "uis"                                                                                                                           },
    (usual) {.port = 391,   .name = "synotics-relay - SynOptics SNMP Relay Port"                                                                                    },
    (usual) {.port = 392,   .name = "synotics-broker - SynOptics Port Broker Port"                                                                                  },
    (usual) {.port = 393,   .name = "dis - Data Interpretation System"                                                                                              },
    (usual) {.port = 394,   .name = "embl-ndt - EMBL Nucleic Data Transfer"                                                                                         },
    (usual) {.port = 395,   .name = "NETscout Control Protocol"                                                                                                     },
    (usual) {.port = 396,   .name = "netware-ip - Novell NetWare encapsulé dans IP"                                                                                 },
    (usual) {.port = 397,   .name = "mptn - Multi Protocol Trans. Net."                                                                                             },
    (usual) {.port = 398,   .name = "kryptolan"                                                                                                                     },
    (usual) {.port = 400,   .name = "work-sol - Worksation Solutions"                                                                                               },
    (usual) {.port = 401,   .name = "ups - Uninteruptible Power Supply"                                                                                             },
    (usual) {.port = 402,   .name = "genie - Genie Protocol"                                                                                                        },
    (usual) {.port = 403,   .name = "decap"                                                                                                                         },
    (usual) {.port = 404,   .name = "nced"                                                                                                                          },
    (usual) {.port = 407,   .name = "Timbuktu (software) "                                                                                                          },
    (usual) {.port = 408,   .name = "prm-sm - Prospero Resource Manager Sys. Man."                                                                                  },
    (usual) {.port = 409,   .name = "prm-nm - Prospero Resource Manager Node Man."                                                                                  },
    (usual) {.port = 410,   .name = "decladebug - DECLadebug Remote Debug Protcol"                                                                                  },
    (usual) {.port = 411,   .name = "rmt - Remote MT Protocol"                                                                                                      },
    (usual) {.port = 412,   .name = "synoptics-trap - Trap Convetion Port"                                                                                          },
    (usual) {.port = 413,   .name = "smsp"                                                                                                                          },
    (usual) {.port = 414,   .name = "infoseek"                                                                                                                      },
    (usual) {.port = 415,   .name = "bnet"                                                                                                                          },
    (usual) {.port = 416,   .name = "silverplatter"                                                                                                                 },
    (usual) {.port = 417,   .name = "onmux"                                                                                                                         },
    (usual) {.port = 418,   .name = "hyper-g"                                                                                                                       },
    (usual) {.port = 419,   .name = "ariel1"                                                                                                                        },
    (usual) {.port = 420,   .name = "smpte"                                                                                                                         },
    (usual) {.port = 421,   .name = "ariel2"                                                                                                                        },
    (usual) {.port = 422,   .name = "ariel3"                                                                                                                        },
    (usual) {.port = 423,   .name = "opc-job-start - IBM Operations Planning and Control Start"                                                                     },
    (usual) {.port = 424,   .name = "opc-job-track - IBM Operations Planning and Control Track"                                                                     },
    (usual) {.port = 425,   .name = "icad-el - ICAD"                                                                                                                },
    (usual) {.port = 426,   .name = "smartsdp"                                                                                                                      },
    (usual) {.port = 427,   .name = "svrloc - Server Location"                                                                                                      },
    (usual) {.port = 428,   .name = "ocs_cmu"                                                                                                                       },
    (usual) {.port = 429,   .name = "ocs_amu"                                                                                                                       },
    (usual) {.port = 430,   .name = "utmpsd"                                                                                                                        },
    (usual) {.port = 431,   .name = "utmpcd"                                                                                                                        },
    (usual) {.port = 432,   .name = "iasd"                                                                                                                          },
    (usual) {.port = 433,   .name = "nnsp"                                                                                                                          },
    (usual) {.port = 434,   .name = "mobileip-agent"                                                                                                                },
    (usual) {.port = 435,   .name = "mobileip-mn"                                                                                                                   },
    (usual) {.port = 436,   .name = "dna-cml"                                                                                                                       },
    (usual) {.port = 437,   .name = "comscm"                                                                                                                        },
    (usual) {.port = 438,   .name = "dsfgw"                                                                                                                         },
    (usual) {.port = 439,   .name = "dasp"                                                                                                                          },
    (usual) {.port = 440,   .name = "sgcp"                                                                                                                          },
    (usual) {.port = 441,   .name = "decvms-sysmgt"                                                                                                                 },
    (usual) {.port = 442,   .name = "cvc_hostd"                                                                                                                     },
    (usual) {.port = 443,   .name = "https (SSL/TLS)"                                                                                                               },
    (usual) {.port = 444,   .name = "snpp - Simple Network Paging Protocol "                                                                                        },
    (usual) {.port = 445,   .name = "microsoft-ds SMB, anciennement appelé CIFS (Common Internet File System)"                                                      },
    (usual) {.port = 446,   .name = "ddm-rdb"                                                                                                                       },
    (usual) {.port = 447,   .name = "ddm-dfm"                                                                                                                       },
    (usual) {.port = 448,   .name = "ddm-byte"                                                                                                                      },
    (usual) {.port = 449,   .name = "as-servermap - AS Server Mapper"                                                                                               },
    (usual) {.port = 450,   .name = "tserver"                                                                                                                       },
    (usual) {.port = 465,   .name = "smtp sécurisé (ssl) (non officiel)"                                                                                            },
    (usual) {.port = 497,   .name = "retrospect - Retrospect Backup software"                                                                                       },
    (usual) {.port = 500,   .name = "ISAKMP (Internet Security Association and Key Management Protocol), un des composants d'IPsec"                                 },
    (usual) {.port = 502,   .name = "Modbus sur TCP."                                                                                                               },
    (usual) {.port = 515,   .name = "printer - spooler"                                                                                                             },
    (usual) {.port = 517,   .name = "talk"                                                                                                                          },
    (usual) {.port = 518,   .name = "ntalk"                                                                                                                         },
    (usual) {.port = 525,   .name = "timed - timeserver"                                                                                                            },
    (usual) {.port = 526,   .name = "tempo - newdate"                                                                                                               },
    (usual) {.port = 548,   .name = "AppleShare IP Server"                                                                                                          },
    (usual) {.port = 554,   .name = "RTSP (Real Time Streaming Protocol) RFC 2326"                                                                                  },
    (usual) {.port = 563,   .name = "nntp sécurisé (ssl) RFC 4642"                                                                                                  },
    (usual) {.port = 587,   .name = "Message Submission for Mail RFC 5068 RFC 6409"                                                                                 },
    (usual) {.port = 631,   .name = "Internet Printing Protocol"                                                                                                    },
    (usual) {.port = 636,   .name = "LDAP encapsulé dans SSL/TLS"                                                                                                   },
    (usual) {.port = 706,   .name = "Secure internet live conferencing"                                                                                             },
    (usual) {.port = 873,   .name = "rsync"                                                                                                                         },
    (usual) {.port = 902,   .name = "VMware Vsphere client et Vcenter heartbeat"                                                                                    },
    (usual) {.port = 989,   .name = "Port de données File Transfer Protocol Secure"                                                                                 },
    (usual) {.port = 990,   .name = "Port de connexion serveur FTPS"                                                                                                },
    (usual) {.port = 993,   .name = "imap sécurisé (ssl)"                                                                                                           },
    (usual) {.port = 995,   .name = "pop3 sécurisé (ssl)"                                                                                                           },
    (usual) {.port = 1080,  .name = "SOCKS"                                                                                                                         },
    (usual) {.port = 1337,  .name = "Port utilisé par les développeurs pour tester des applications (Leet speak)"                                                   },
    (usual) {.port = 1135,  .name = "OmniVision Communication Service"                                                                                              },
    (usual) {.port = 1194,  .name = "OpenVPN"                                                                                                                       },
    (usual) {.port = 1352,  .name = "Lotus Notes"                                                                                                                   },
    (usual) {.port = 1414,  .name = "IBM MQSeries"                                                                                                                  },
    (usual) {.port = 1433,  .name = "Microsoft SQL Server"                                                                                                          },
    (usual) {.port = 1434,  .name = "Microsoft SQL Monitor"                                                                                                         },
    (usual) {.port = 1521,  .name = "Serveur Oracle ou ncube-lm"                                                                                                    },
    (usual) {.port = 1524,  .name = "Ingreslock, voir Ingres (base de données)"                                                                                     },
    (usual) {.port = 1720,  .name = "H.323"                                                                                                                         },
    (usual) {.port = 1723,  .name = "PPTP"                                                                                                                          },
    (usual) {.port = 1863,  .name = "MSN (tchat)"                                                                                                                   },
    (usual) {.port = 1883,  .name = "MQTT"                                                                                                                          },
    (usual) {.port = 2049,  .name = "NFSv4"                                                                                                                         },
    (usual) {.port = 2106,  .name = "L2J LoginServer"                                                                                                               },
    (usual) {.port = 2164,  .name = "Dynamic DNS"                                                                                                                   },
    (usual) {.port = 2382,  .name = "ms-olap3"                                                                                                                      },
    (usual) {.port = 3000,  .name = "First Class Server"                                                                                                            },
    (usual) {.port = 3051,  .name = "AMS (Agency Management System)"                                                                                                },
    (usual) {.port = 3306,  .name = "Mysql Server"                                                                                                                  },
    (usual) {.port = 3389,  .name = "Microsoft Terminal Server (RDP)"                                                                                               },
    (usual) {.port = 3632,  .name = "distcc (compilation partagée)"                                                                                                 },
    (usual) {.port = 3644,  .name = "Evidian, ssowatch"                                                                                                             },
    (usual) {.port = 5222,  .name = "serveur Jabber"                                                                                                                },
    (usual) {.port = 5223,  .name = "serveur Jabber sécurisé (ssl)"                                                                                                 },
    (usual) {.port = 5269,  .name = "serveur à serveur (server to server) Jabber"                                                                                   },
    (usual) {.port = 5280,  .name = "serveur BOSH"                                                                                                                  },
    (usual) {.port = 5432,  .name = "serveur PostgreSQL"                                                                                                            },
    (usual) {.port = 5498,  .name = "Hotline Tracker"                                                                                                               },
    (usual) {.port = 5500,  .name = "Hotline Server"                                                                                                                },
    (usual) {.port = 5501,  .name = "Hotline Server"                                                                                                                },
    (usual) {.port = 5900,  .name = "VNC Server"                                                                                                                    },
    (usual) {.port = 5984,  .name = "CouchDB Server"                                                                                                                },
    (usual) {.port = 6112,  .name = "Warcraft III"                                                                                                                  },
    (usual) {.port = 6522,  .name = "Gobby Server (Sobby)"                                                                                                          },
    (usual) {.port = 6557,  .name = "Monitoring"                                                                                                                    },
    (usual) {.port = 6667,  .name = "Serveur IRC"                                                                                                                   },
    (usual) {.port = 6697,  .name = "Serveur IRC sécurisé (ssl)"                                                                                                    },
    (usual) {.port = 7000,  .name = "Serveur IRC sécurisé (ssl) alternatif"                                                                                         },
    (usual) {.port = 7648,  .name = "CU-SeeMe "                                                                                                                     },
    (usual) {.port = 8000,  .name = "Hotline"                                                                                                                       },
    (usual) {.port = 8006,  .name = "Dell AppAssure  Replication/Management Interface"                                                                              },
    (usual) {.port = 8008,  .name = "Serveur CalDAV"                                                                                                                },
    (usual) {.port = 8009,  .name = "Port AJP utilisé par Tomcat"                                                                                                   },
    (usual) {.port = 8080,  .name = "http alternatif (webcache)"                                                                                                    },
    (usual) {.port = 8098,  .name = "Administration Microsoft Windows Server 2003"                                                                                  },
    (usual) {.port = 8140,  .name = "Serveur Puppet (port par défaut pour le master)"                                                                               },
    (usual) {.port = 8443,  .name = "Serveur CalDAV sécurisé (ssl)"                                                                                                 },
    (usual) {.port = 8787,  .name = "Serveur RStudio"                                                                                                               },
    (usual) {.port = 8883,  .name = "MQTT sécurisé (SSL)"                                                                                                           },
    (usual) {.port = 8888,  .name = "VolumeOnLan client/serveur"                                                                                                    },
    (usual) {.port = 9009,  .name = "Pichat - Peer to peer webchat software"                                                                                        },
    (usual) {.port = 9443,  .name = "VMware HTTPS (TCP) Accès et administration de vCenter Server via l'interface Web"                                              },
    (usual) {.port = 10011, .name = "Accès distant Livebox sécurisé HTTPS"                                                                                          },
    (usual) {.port = 22000, .name = "Syncthing Block Exchange Protocol"                                                                                             },
    (usual) {.port = 22067, .name = "Syncthing Relay"                                                                                                               },
    (usual) {.port = 22070, .name = "Syncthing Relay Status"                                                                                                        },
    (usual) {.port = 22968, .name = "Plex media server"                                                                                                             },
    (usual) {.port = 25444, .name = "Serveur Unturned"                                                                                                              },
    (usual) {.port = 27017, .name = "MongoDB"                                                                                                                       },
    // combo
    (usual) {.port = 2106,  .name = "L2J LoginServer"                                                                                                               },
    (usual) {.port = 2164,  .name = "Dynamic DNS"                                                                                                                   },
    (usual) {.port = 3074,  .name = "Nintendo server"                                                                                                               },
    (usual) {.port = 3725,  .name = "Netia NA-ER Port"                                                                                                              },
    (usual) {.port = 3979,  .name = "Serveur Transport Tycoon deluxe en open source (openttd)"                                                                      },
    (usual) {.port = 5003,  .name = "FileMaker network sharing"                                                                                                     },
    (usual) {.port = 5009,  .name = "Apple AirPort Admin Utility, AirPort Express Assistant, Xwis"                                                                  },
    (usual) {.port = 5060,  .name = "serveur SIP (Session Initiation Protocol)"                                                                                     },
    (usual) {.port = 5062,  .name = "Localisation access"                                                                                                           },
    (usual) {.port = 5353,  .name = "Multicast DNS"                                                                                                                 },
    (usual) {.port = 6000,  .name = "X11"                                                                                                                           },
    (usual) {.port = 7725,  .name = "Port par défaut de Faronics Deep Freeze (console/serveur)"                                                                     },
    (usual) {.port = 7777,  .name = "Serveur Terraria / L2J Gameserver"                                                                                             },
    (usual) {.port = 9000,  .name = "cslistener"                                                                                                                    },
    (usual) {.port = 10001, .name = "SCP-Config"                                                                                                                    },
    (usual) {.port = 11371, .name = "OpenPGP - OpenPGP HTTP Keyserver"                                                                                              },
    (usual) {.port = 20003, .name = "WriteEasy Office: Coordination affichage utilisateur et serveur local | Serveur API pour logiciels tiers"                      },
    (usual) {.port = 25565, .name = "Serveur Minecraft"                                                                                                             },
    (usual) {.port = 27000, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27001, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27002, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27003, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27004, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27005, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27006, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27007, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27008, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27009, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27010, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27011, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27012, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27013, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27014, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27015, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27016, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27017, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27018, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27019, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27020, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27021, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27022, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27023, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27024, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27025, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27026, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27027, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27028, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27029, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27030, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27031, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27032, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27033, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27034, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27035, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27036, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27037, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27038, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27039, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27040, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27041, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27042, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27043, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27044, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27045, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27046, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27047, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27048, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27049, .name = "Serveur Steam"                                                                                                                 },
    (usual) {.port = 27050, .name = "Serveur Steam"                                                                                                                 },

    (usual) {.port = 0,     .name = 0                                                                                                                       }
};
usual udp_names[] = {
    (usual) {.port = 50,    .name = "re-mail-ck - Remote Mail Checking Protocol"                                                                                                                                                       },
    (usual) {.port = 53,    .name = "domain - Domain Name System (DNS)"                                                                                                                                                                },
    (usual) {.port = 54,    .name = "xns-ch - XNS Clearinghouse"                                                                                                                                                                       },
    (usual) {.port = 67,    .name = "bootps - Bootstrap Protocol Server, ce port est aussi utilisé par une extension de bootp : DHCP, pour la recherche d'un serveur DHCP"                                                             },
    (usual) {.port = 68,    .name = "bootpc - Bootstrap Protocol Client, ce port est aussi utilisé par une extension de bootp : DHCP, pour le dialogue entre le serveur DHCP et le client (attribution d'un bail pour une adresse IP)" },
    (usual) {.port = 69,    .name = "tftp - Trivial File Transfer Protocol"                                                                                                                                                            },
    (usual) {.port = 123,   .name = "ntp - Network Time Protocol RFC 5905"                                                                                                                                                             },
    (usual) {.port = 161,   .name = "SNMP - Simple Network Management Protocol"                                                                                                                                                        },
    (usual) {.port = 162,   .name = "snmptrap - Simple Network Management Protocol Trap"                                                                                                                                               },
    (usual) {.port = 264,   .name = "BGMP - Border Gateway Multicast Protocol"                                                                                                                                                         },
    (usual) {.port = 445,   .name = "microsoft-ds SMB, anciennement appelé CIFS (Common Internet File System)"                                                                                                                         },
    (usual) {.port = 514,   .name = "Syslog RFC 3164 NB : ce service n'est pas listé habituellement dans le fichier etc\\services"                                                                                                     },
    (usual) {.port = 520,   .name = "Routing"                                                                                                                                                                                          },
    (usual) {.port = 546,   .name = "DHCP - Dynamic Host Configuration Protocol v6 (for IPv6)"                                                                                                                                         },
    (usual) {.port = 706,   .name = "Secure internet live conferencing"                                                                                                                                                                },
    (usual) {.port = 902,   .name = "VMware Vsphere client et Vcenter heartbeat"                                                                                                                                                       },
    (usual) {.port = 1135,  .name = "OmniVision Communication Service"                                                                                                                                                                 },
    (usual) {.port = 1194,  .name = "OpenVPN"                                                                                                                                                                                          },
    (usual) {.port = 1337,  .name = "Port utilisé par les développeurs pour tester des applications (Leet speak)"                                                                                                                      },
    (usual) {.port = 2427,  .name = "MGCP"                                                                                                                                                                                             },
    (usual) {.port = 4569,  .name = "IAX2 Inter-Asterisk-Exchange (rfc5456)"                                                                                                                                                           },
    (usual) {.port = 47808, .name = "BACnet (BAC0 à BACF)"                                                                                                                                                                             },
    (usual) {.port = 47809, .name = "BACnet (BAC0 à BACF)"                                                                                                                                                                             },
    (usual) {.port = 47810, .name = "BACnet (BAC0 à BACF)"                                                                                                                                                                             },
    (usual) {.port = 47811, .name = "BACnet (BAC0 à BACF)"                                                                                                                                                                             },
    (usual) {.port = 47812, .name = "BACnet (BAC0 à BACF)"                                                                                                                                                                             },
    (usual) {.port = 47813, .name = "BACnet (BAC0 à BACF)"                                                                                                                                                                             },
    (usual) {.port = 47814, .name = "BACnet (BAC0 à BACF)"                                                                                                                                                                             },
    (usual) {.port = 47815, .name = "BACnet (BAC0 à BACF)"                                                                                                                                                                             },
    (usual) {.port = 47816, .name = "BACnet (BAC0 à BACF)"                                                                                                                                                                             },
    (usual) {.port = 47817, .name = "BACnet (BAC0 à BACF)"                                                                                                                                                                             },
    (usual) {.port = 47818, .name = "BACnet (BAC0 à BACF)"                                                                                                                                                                             },
    (usual) {.port = 47819, .name = "BACnet (BAC0 à BACF)"                                                                                                                                                                             },
    (usual) {.port = 47820, .name = "BACnet (BAC0 à BACF)"                                                                                                                                                                             },
    (usual) {.port = 47821, .name = "BACnet (BAC0 à BACF)"                                                                                                                                                                             },
    (usual) {.port = 47822, .name = "BACnet (BAC0 à BACF)"                                                                                                                                                                             },
    (usual) {.port = 47823, .name = "BACnet (BAC0 à BACF)"                                                                                                                                                                             },
    // combo
    (usual) {.port = 2106,  .name = "L2J LoginServer"                                                                                                                                                                                  },
    (usual) {.port = 2164,  .name = "Dynamic DNS"                                                                                                                                                                                      },
    (usual) {.port = 3074,  .name = "Nintendo server"                                                                                                                                                                                  },
    (usual) {.port = 3725,  .name = "Netia NA-ER Port"                                                                                                                                                                                 },
    (usual) {.port = 3979,  .name = "Serveur Transport Tycoon deluxe en open source (openttd)"                                                                                                                                         },
    (usual) {.port = 5003,  .name = "FileMaker network sharing"                                                                                                                                                                        },
    (usual) {.port = 5009,  .name = "Apple AirPort Admin Utility, AirPort Express Assistant, Xwis"                                                                                                                                     },
    (usual) {.port = 5060,  .name = "serveur SIP (Session Initiation Protocol)"                                                                                                                                                        },
    (usual) {.port = 5062,  .name = "Localisation access"                                                                                                                                                                              },
    (usual) {.port = 5353,  .name = "Multicast DNS"                                                                                                                                                                                    },
    (usual) {.port = 6000,  .name = "X11"                                                                                                                                                                                              },
    (usual) {.port = 7725,  .name = "Port par défaut de Faronics Deep Freeze (console/serveur)"                                                                                                                                        },
    (usual) {.port = 7777,  .name = "Serveur Terraria / L2J Gameserver"                                                                                                                                                                },
    (usual) {.port = 9000,  .name = "cslistener"                                                                                                                                                                                       },
    (usual) {.port = 10001, .name = "SCP-Config"                                                                                                                                                                                       },
    (usual) {.port = 11371, .name = "OpenPGP - OpenPGP HTTP Keyserver"                                                                                                                                                                 },
    (usual) {.port = 20003, .name = "WriteEasy Office: Coordination affichage utilisateur et serveur local | Serveur API pour logiciels tiers"                                                                                         },
    (usual) {.port = 25565, .name = "Serveur Minecraft"                                                                                                                                                                                },
    (usual) {.port = 27000, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27001, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27002, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27003, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27004, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27005, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27006, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27007, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27008, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27009, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27010, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27011, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27012, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27013, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27014, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27015, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27016, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27017, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27018, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27019, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27020, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27021, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27022, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27023, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27024, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27025, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27026, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27027, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27028, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27029, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27030, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27031, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27032, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27033, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27034, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27035, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27036, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27037, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27038, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27039, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27040, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27041, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27042, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27043, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27044, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27045, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27046, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27047, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27048, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27049, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 27050, .name = "Serveur Steam"                                                                                                                                                                                    },
    (usual) {.port = 0,     .name = 0                                                                                                                                                                                          }
};

bool scan_main(int argc, char **argv) {
    struct {
        char *name;
        int  (*make_socket)();
        bool (*scan_port)(int, in_addr_t, in_addr_t, uint16_t, in_addr_t);
        bool uses_zombie;
        int protocol;
    }
    scanners[] = {
        {
            "tcp-syn",
            make_tcp_socket,
            tcp_scan_port_syn,
            false,
            TCP
        },
        {
            "tcp-synack",
            make_tcp_socket,
            tcp_scan_port_synack,
            false,
            TCP
        },
        {
            "tcp-idle",
            make_tcp_socket,
            tcp_scan_port_idle,
            true,
            TCP
        },
        {
            "udp",
            make_udp_socket,
            udp_scan_port,
            false,
            UDP
        }
    };



    if (argc < 5) {
        return false;
    }

    size_t scanner_i;
    for (scanner_i = 0;
         scanner_i < sizeof(scanners) / sizeof(scanners[0]) &&
         strcmp(scanners[scanner_i].name, argv[2]) != 0;
         scanner_i++) {
    }

    if (scanner_i == sizeof(scanners) / sizeof(scanners[0])) {
        return false;
    }


    in_addr_t src_addr    = inet_addr(argv[3]);
    in_addr_t dst_addr    = inet_addr(argv[4]);
    in_addr_t zombie_addr = 0;
    int       offset      = 0;

    if (scanners[scanner_i].uses_zombie) {
        zombie_addr = inet_addr(argv[5]);
        offset      = 1;
    }

    uint16_t port_min = 0x0000;
    uint16_t port_max = 0xffff;

    if (argc >= 6 + offset) {
        port_min = atoi(argv[5 + offset]);
        port_max = port_min;
    }

    if (argc >= 7 + offset) {
        port_max = atoi(argv[6 + offset]);
    }


    int s = scanners[scanner_i].make_socket();
    int open_port_count = 0 ;
    struct timespec start, end;
    clock_gettime(CLOCK_MONOTONIC_RAW, &start);
    printf("PORT\tSTATE\tSERVICE\n");

    for (uint32_t port = port_min; port <= port_max; port++) {
        printf("%d", port);
        fflush(stdout);
        bool port_is_open = scanners[scanner_i].scan_port(s, src_addr, dst_addr,
                                                          port, zombie_addr);
        NULL;
        if(port_is_open){
          open_port_count++;
          printf("\t%s", "\x1b[32mopen\x1b[0m");
          char * guess = get_service_port_name(port, scanners[scanner_i].protocol);
          if(guess != 0){
            printf("\t%s", guess);
          }
          printf("\n");
        } else {
          printf("%s", "\x1b[1K\r");
        }
    }

    clock_gettime(CLOCK_MONOTONIC_RAW, &end);
    printf("\n\nmyNmap done : found %d open port on host %s in %d.%d seconds\n",
            open_port_count, argv[4],
            (int) (end.tv_sec - start.tv_sec),
            (int) ((end.tv_nsec - start.tv_nsec)/10000000));
    shutdown(s, 2);

    return true;
}


char *get_service_port_name(uint16_t port, int protocol) {
    usual *services_names = (protocol == 0) ? tcp_names : udp_names;

    int i = 0;

    while (services_names[i].port != 0 && services_names[i].port != port) {
        //printf("%d\n", i);
        i++;
    }
    return services_names[i].name;
}
